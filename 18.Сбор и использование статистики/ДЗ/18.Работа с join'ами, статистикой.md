# Тема: Сбор и использование статистики

## Домашнее задание: "Работа с join'ами, статистикой"

### 1. Реализовать прямое соединение двух или более таблиц
```sql
-- Сначала выводим для каждаго автобусного маршрута соответствующую марку автобуса и его водителя
postgres=# SELECT * FROM bus b, model_bus mb, driver d WHERE b.id_model = mb.id and b.id_driver = d.id;
id |      route       | id_model | id_driver | id | name | id | first_name | second_name 
----+------------------+----------+-----------+----+------+----+------------+-------------
  1 | Москва-Болшево   |        1 |         1 |  1 | ПАЗ  |  1 | Иван       | Иванов
  2 | Москва-Пушкино   |        1 |         2 |  1 | ПАЗ  |  2 | Петр       | Петров
  3 | Москва-Ярославль |        2 |         3 |  2 | ЛИАЗ |  3 | Савелий    | Сидоров
  4 | Москва-Кострома  |        2 |         4 |  2 | ЛИАЗ |  4 | Антон      | Шторкин
  5 | Москва-Волгорад  |        3 |         5 |  3 | MAN  |  5 | Олег       | Зажигаев
(5 rows)
```
### 2. Реализовать левостороннее (или правостороннее) соединение двух или более таблиц
```sql
-- Сначала выводим для каждаго автобусного маршрута соответствующую марку автобуса
postgres=# SELECT * FROM bus b LEFT JOIN model_bus mb ON b.id_model = mb.id;
id |      route       | id_model | id_driver | id | name 
----+------------------+----------+-----------+----+------
  1 | Москва-Болшево   |        1 |         1 |  1 | ПАЗ
  2 | Москва-Пушкино   |        1 |         2 |  1 | ПАЗ
  3 | Москва-Ярославль |        2 |         3 |  2 | ЛИАЗ
  4 | Москва-Кострома  |        2 |         4 |  2 | ЛИАЗ
  5 | Москва-Волгорад  |        3 |         5 |  3 | MAN
  6 | Москва-Иваново   |          |           |    | 
(6 rows)
```
### 3. Реализовать кросс соединение двух или более таблиц
```sql
-- В результирующем наборе для каждой записи автобусного маршрута выводится каждая запись из таблицы марок автобусов
postgres=# SELECT * FROM bus b CROSS JOIN model_bus mb;
id |      route       | id_model | id_driver | id | name  
----+------------------+----------+-----------+----+-------
  1 | Москва-Болшево   |        1 |         1 |  1 | ПАЗ
  2 | Москва-Пушкино   |        1 |         2 |  1 | ПАЗ
  3 | Москва-Ярославль |        2 |         3 |  1 | ПАЗ
  4 | Москва-Кострома  |        2 |         4 |  1 | ПАЗ
  5 | Москва-Волгорад  |        3 |         5 |  1 | ПАЗ
  6 | Москва-Иваново   |          |           |  1 | ПАЗ
  1 | Москва-Болшево   |        1 |         1 |  2 | ЛИАЗ
  2 | Москва-Пушкино   |        1 |         2 |  2 | ЛИАЗ
  3 | Москва-Ярославль |        2 |         3 |  2 | ЛИАЗ
  4 | Москва-Кострома  |        2 |         4 |  2 | ЛИАЗ
  5 | Москва-Волгорад  |        3 |         5 |  2 | ЛИАЗ
  6 | Москва-Иваново   |          |           |  2 | ЛИАЗ
  1 | Москва-Болшево   |        1 |         1 |  3 | MAN
  2 | Москва-Пушкино   |        1 |         2 |  3 | MAN
  3 | Москва-Ярославль |        2 |         3 |  3 | MAN
  4 | Москва-Кострома  |        2 |         4 |  3 | MAN
  5 | Москва-Волгорад  |        3 |         5 |  3 | MAN
  6 | Москва-Иваново   |          |           |  3 | MAN
  1 | Москва-Болшево   |        1 |         1 |  4 | МАЗ
  2 | Москва-Пушкино   |        1 |         2 |  4 | МАЗ
  3 | Москва-Ярославль |        2 |         3 |  4 | МАЗ
  4 | Москва-Кострома  |        2 |         4 |  4 | МАЗ
  5 | Москва-Волгорад  |        3 |         5 |  4 | МАЗ
  6 | Москва-Иваново   |          |           |  4 | МАЗ
  1 | Москва-Болшево   |        1 |         1 |  5 | НЕФАЗ
  2 | Москва-Пушкино   |        1 |         2 |  5 | НЕФАЗ
  3 | Москва-Ярославль |        2 |         3 |  5 | НЕФАЗ
  4 | Москва-Кострома  |        2 |         4 |  5 | НЕФАЗ
  5 | Москва-Волгорад  |        3 |         5 |  5 | НЕФАЗ
  6 | Москва-Иваново   |          |           |  5 | НЕФАЗ
(30 rows)
```
### 4. Реализовать полное соединение двух или более таблиц
```sql
-- Выводяться все записи из таблиц маршрутов и марок автобусов, при этом сопостовляются записи по заданной связи айдишников
postgres=# SELECT * FROM bus b FULL OUTER JOIN model_bus mb ON b.id_model = mb.id;
id |      route       | id_model | id_driver | id | name  
----+------------------+----------+-----------+----+-------
  1 | Москва-Болшево   |        1 |         1 |  1 | ПАЗ
  2 | Москва-Пушкино   |        1 |         2 |  1 | ПАЗ
  3 | Москва-Ярославль |        2 |         3 |  2 | ЛИАЗ
  4 | Москва-Кострома  |        2 |         4 |  2 | ЛИАЗ
  5 | Москва-Волгорад  |        3 |         5 |  3 | MAN
  6 | Москва-Иваново   |          |           |    | 
    |                  |          |           |  4 | МАЗ
    |                  |          |           |  5 | НЕФАЗ
(8 rows)
```
### 5. Реализовать запрос, в котором будут использованы разные типы соединений
```sql
-- Сначала выводим для каждаго автобусного маршрута соответствующую марку автобуса, а затем для каждого водителя - соответствующий ему маршрут с маркой автобуса
postgres=# SELECT * FROM bus b LEFT JOIN model_bus mb ON b.id_model = mb.id RIGHT JOIN driver d ON d.id = b.id_driver;
id |      route       | id_model | id_driver | id | name | id | first_name | second_name 
----+------------------+----------+-----------+----+------+----+------------+-------------
  1 | Москва-Болшево   |        1 |         1 |  1 | ПАЗ  |  1 | Иван       | Иванов
  2 | Москва-Пушкино   |        1 |         2 |  1 | ПАЗ  |  2 | Петр       | Петров
  3 | Москва-Ярославль |        2 |         3 |  2 | ЛИАЗ |  3 | Савелий    | Сидоров
  4 | Москва-Кострома  |        2 |         4 |  2 | ЛИАЗ |  4 | Антон      | Шторкин
  5 | Москва-Волгорад  |        3 |         5 |  3 | MAN  |  5 | Олег       | Зажигаев
    |                  |          |           |    |      |  6 | Аркадий    | Паровозов
(6 rows)
```
### 6. Сделать комментарии на каждый запрос
- Сделал перед запросами
### 7. К работе приложить структуру таблиц, для которых выполнялись соединения
```sql
postgres=# CREATE TABLE bus (id SERIAL, route TEXT, id_model INT, id_driver INT);
postgres=# CREATE TABLE model_bus (id SERIAL, name TEXT);
postgres=# CREATE TABLE driver (id SERIAL, first_name TEXT, second_name TEXT);

postgres=# INSERT INTO bus VALUES
                    (1, 'Москва-Болшево', 1, 1),
                    (2, 'Москва-Пушкино', 1, 2),
                    (3, 'Москва-Ярославль', 2, 3),
                    (4, 'Москва-Кострома', 2, 4),
                    (5, 'Москва-Волгорад', 3, 5),
                    (6, 'Москва-Иваново', NULL, NULL);

postgres=# INSERT INTO model_bus VALUES
                          (1, 'ПАЗ'),
                          (2, 'ЛИАЗ'),
                          (3, 'MAN'),
                          (4, 'МАЗ'),
                          (5, 'НЕФАЗ');

postgres=# INSERT INTO driver VALUES
                       (1, 'Иван', 'Иванов'),
                       (2, 'Петр', 'Петров'),
                       (3, 'Савелий', 'Сидоров'),
                       (4, 'Антон', 'Шторкин'),
                       (5, 'Олег', 'Зажигаев'),
                       (6, 'Аркадий', 'Паровозов');
```